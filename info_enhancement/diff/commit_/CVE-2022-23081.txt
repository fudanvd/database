diff --git a/openlibrary/macros/Paginate.html b/openlibrary/macros/Paginate.html
index 3bf0eb136f7..79f3b67dece 100644
--- a/openlibrary/macros/Paginate.html
+++ b/openlibrary/macros/Paginate.html
@@ -5,8 +5,8 @@
 
 <div class="sansserif">
 $if page != 0:
-    <a href="$:changequery(page=page - 1)" rel="nofollow">&lt; $_.prev</a> <strong>&middot;</strong>
+    <a href="$changequery(page=page - 1)" rel="nofollow">&lt; $_.prev</a> <strong>&middot;</strong>
 
 $if len(pages) == limit:
-    <a href="$:changequery(page=page + 1)" rel="nofollow">$_.next &gt;</a>
+    <a href="$changequery(page=page + 1)" rel="nofollow">$_.next &gt;</a>
 </div>
\ No newline at end of file
diff --git a/openlibrary/macros/RecentChanges.html b/openlibrary/macros/RecentChanges.html
index ceee4c2aa44..bc38b83ddc1 100644
--- a/openlibrary/macros/RecentChanges.html
+++ b/openlibrary/macros/RecentChanges.html
@@ -51,10 +51,10 @@
     </table>
     <div class="historyPager small sansserif gray">
     $if len(changes) == limit:
-        <a href="$:changequery(page=page + 1)$hash" rel="nofollow">&larr; $_("Older")</a>
+        <a href="$changequery(page=page + 1)$hash" rel="nofollow">&larr; $_("Older")</a>
     $if page > 1:
          &nbsp;|&nbsp;
-        <a href="$:changequery(page=page - 1)$hash" rel="nofollow">$_("Newer") &rarr;</a>
+        <a href="$changequery(page=page - 1)$hash" rel="nofollow">$_("Newer") &rarr;</a>
     </div>
 
 $if ip or author:
diff --git a/openlibrary/macros/RecentChangesAdmin.html b/openlibrary/macros/RecentChangesAdmin.html
index 29656c32d95..7f5fe37f54a 100644
--- a/openlibrary/macros/RecentChangesAdmin.html
+++ b/openlibrary/macros/RecentChangesAdmin.html
@@ -49,9 +49,9 @@
 
     <div class="historyPager small sansserif gray" style="width:100%;">
     $if len(changes) == limit:
-        <a href="$:changequery(page=page + 1)" rel="nofollow">&larr; $_("Older")</a> &nbsp;|&nbsp;
+        <a href="$changequery(page=page + 1)" rel="nofollow">&larr; $_("Older")</a> &nbsp;|&nbsp;
     $if page != 0:
-        <a href="$:changequery(page=page - 1)" rel="nofollow">$_("Newer") &rarr;</a>
+        <a href="$changequery(page=page - 1)" rel="nofollow">$_("Newer") &rarr;</a>
     $else:
         $_("Newer") &rarr;
     </div>
diff --git a/openlibrary/macros/RecentChangesUsers.html b/openlibrary/macros/RecentChangesUsers.html
index 000c96055bc..b1a6edab7d5 100644
--- a/openlibrary/macros/RecentChangesUsers.html
+++ b/openlibrary/macros/RecentChangesUsers.html
@@ -51,10 +51,10 @@ <h2>Recent Activity</h2>
 
     <div class="historyPager small sansserif gray" style="width:100%;">
     $if len(changes) == limit:
-        <a href="$:changequery(page=page + 1)" rel="nofollow">&larr; $_("Older")</a>
+        <a href="$changequery(page=page + 1)" rel="nofollow">&larr; $_("Older")</a>
     $if page != 0:
          &nbsp;|&nbsp;
-         <a href="$:changequery(page=page - 1)" rel="nofollow">$_("Newer") &rarr;</a>
+         <a href="$changequery(page=page - 1)" rel="nofollow">$_("Newer") &rarr;</a>
     </div>
 $else:
     <p>$_("No edits. Yet.")</p>
diff --git a/openlibrary/macros/WorkInfo.html b/openlibrary/macros/WorkInfo.html
index 73347188866..1f1e9702ad1 100644
--- a/openlibrary/macros/WorkInfo.html
+++ b/openlibrary/macros/WorkInfo.html
@@ -20,7 +20,7 @@
                 <td><span class="object">
                 $for name in subjects:
                     $for subject in page[name]:
-                        <a href="/search?ftokens=$:utf8(facet_token('subjects', subject.strip()))">$:utf8(thingrepr(subject)).replace(' -- ', '/')</a>,
+                        <a href="/search?ftokens=$utf8(facet_token('subjects', subject.strip()))">$:utf8(thingrepr(subject)).replace(' -- ', '/')</a>,
                 </span></td></tr>
             $else:
                 <td><span class="object">$:thingrepr(page[name])</span></td></tr>
diff --git a/openlibrary/templates/admin/people/edits.html b/openlibrary/templates/admin/people/edits.html
index b4557c471fc..37fb3475b90 100644
--- a/openlibrary/templates/admin/people/edits.html
+++ b/openlibrary/templates/admin/people/edits.html
@@ -90,9 +90,9 @@ <h1><a class="plain" href="/admin/people">people</a> / <a class="plain" href="/a
 $if paginate:
     <div class="historyPager small sansserif gray">
         $if len(changes) == limit:
-            <a href="$:changequery(page=page + 1)" rel="nofollow">&larr; $_("Older")</a>
+            <a href="$changequery(page=page + 1)" rel="nofollow">&larr; $_("Older")</a>
         $if page > 1:
              &nbsp;|&nbsp;
-            <a href="$:changequery(page=page - 1)" rel="nofollow">$_("Newer") &rarr;</a>
+            <a href="$changequery(page=page - 1)" rel="nofollow">$_("Newer") &rarr;</a>
     </div>
 </div>
diff --git a/openlibrary/templates/history.html b/openlibrary/templates/history.html
index 0e8a1272f1d..354be40ad05 100644
--- a/openlibrary/templates/history.html
+++ b/openlibrary/templates/history.html
@@ -78,9 +78,9 @@ <h1><a href="$page.key">$name</a></h1>
         <div class="sansserif">
         $ page = safeint(query_param("page", "0"))
         $if page != 0:
-            <a href="$:changequery(page=page - 1)" rel="nofollow">&larr; $_("Back")</a>
+            <a href="$changequery(page=page - 1)" rel="nofollow">&larr; $_("Back")</a>
         $if len(h) == 20:
-            <a href="$:changequery(page=page + 1)" rel="nofollow">$_("Next") &rarr;</a>
+            <a href="$changequery(page=page + 1)" rel="nofollow">$_("Next") &rarr;</a>
         </div>
 
 </div>
diff --git a/openlibrary/templates/lib/nav_foot.html b/openlibrary/templates/lib/nav_foot.html
index 0b8c90296fc..2fa1cd27f2b 100644
--- a/openlibrary/templates/lib/nav_foot.html
+++ b/openlibrary/templates/lib/nav_foot.html
@@ -41,7 +41,7 @@ <h2>$:_('Develop')</h2>
         <h2>$:_('Help')</h2>
         <ul>
           <li><a href="/help">$_('Help Center')</a></li>
-          <li><a href="/contact?$:urlencode(dict(path=request.fullpath))" title="$_('Problems')">$_('Report A Problem')</a></li>
+          <li><a href="/contact?$urlencode(dict(path=request.fullpath))" title="$_('Problems')">$_('Report A Problem')</a></li>
           <li><a href="/help/faq/editing" title="$_('Suggest Edits')">$_('Suggesting Edits')</a></li>
         </ul>
         <aside id="footer-icons">
diff --git a/openlibrary/templates/notfound.html b/openlibrary/templates/notfound.html
index b54546f167f..b461dfbb8d9 100644
--- a/openlibrary/templates/notfound.html
+++ b/openlibrary/templates/notfound.html
@@ -15,7 +15,7 @@ <h1>$_("404 - Page Not Found")</h1>
 
     $# Show create link only to admins
     $if ctx.user and ctx.user.is_admin() and create:
-        <p><a class="adminOnly" href="$:url(path, m='edit')">$_("Create it?")</a></p>
+        <p><a class="adminOnly" href="$changequery(m='edit')">$_("Create it?")</a></p>
 
     <div>
     $if "/templates" in path or "/macros" in path:
diff --git a/openlibrary/templates/recentchanges/render.html b/openlibrary/templates/recentchanges/render.html
index 308d9fe2ee7..8597057fd98 100644
--- a/openlibrary/templates/recentchanges/render.html
+++ b/openlibrary/templates/recentchanges/render.html
@@ -56,8 +56,8 @@
 $if paginate:
     <div class="historyPager small sansserif gray">
         $if len(changes) == limit:
-            <a href="$:changequery(page=page + 1)$hash" rel="nofollow">&larr; $_("Older")</a>
+            <a href="$changequery(page=page + 1)$hash" rel="nofollow">&larr; $_("Older")</a>
         $if page > 1:
              &nbsp;|&nbsp;
-            <a href="$:changequery(page=page - 1)$hash" rel="nofollow">$_("Newer") &rarr;</a>
+            <a href="$changequery(page=page - 1)$hash" rel="nofollow">$_("Newer") &rarr;</a>
     </div>
diff --git a/openlibrary/templates/work_search.html b/openlibrary/templates/work_search.html
index ed4d482267d..1a7e0130372 100644
--- a/openlibrary/templates/work_search.html
+++ b/openlibrary/templates/work_search.html
@@ -2,17 +2,18 @@
 
 $ fulltext_names = {'true': 'Ebooks', 'false': 'Exclude ebooks'}
 
-$def add_facet_url(k, v):
-    $if k != 'has_fulltext':
-        $changequery(page=None,**{k:param.get(k, []) + [v]})
-    $else:
-        $changequery(page=None,**{k:v})
-
-$def del_facet_url(k, v):
-    $if k != 'has_fulltext':
-        $changequery(page=None,**{k:[i for i in param.get(k, []) if i != v]})
-    $else:
-        $changequery(page=None,**{k:None})
+$code:
+    def add_facet_url(k, v):
+        if k != 'has_fulltext':
+            return changequery(page=None,**{k:param.get(k, []) + [v]})
+        else:
+            return changequery(page=None,**{k:v})
+
+    def del_facet_url(k, v):
+        if k != 'has_fulltext':
+            return changequery(page=None,**{k:[i for i in param.get(k, []) if i != v]})
+        else:
+            return changequery(page=None,**{k:None})
 
 $ param = {}
 $for p in ['q', 'title', 'author', 'page', 'sort', 'isbn', 'oclc', 'contributor', 'publish_place', 'lccn', 'ia', 'first_sentence', 'publisher', 'author_key', 'debug', 'subject', 'place', 'person', 'time'] + facet_fields:
@@ -135,7 +136,7 @@
                             <span title="$_('Published by')">$display</span>
                         $elif header == 'author_key':
                             <span title="$_('Author')">$display</span>
-                        <span style="padding-right:15px;"><a href="$:del_facet_url(header, k)" title="$_('Click to remove this facet')" class="facetRemove plain red">[x]</a></span>
+                        <span style="padding-right:15px;"><a href="$del_facet_url(header, k)" title="$_('Click to remove this facet')" class="facetRemove plain red">[x]</a></span>
                 </strong></span></p>
             $var title: $_('%(title)s - search', title=', '.join(title))
 
@@ -214,9 +215,9 @@ <h4 class="facetHead">$label</h4>
                        $ display = _('yes')
                     $else:
                        $ display = _('no')
-                    <span class="small"><a href="$:add_facet_url(header, k)" title="$_('Filter results for ebook availability')">$display</a></span>&nbsp;<span class="smaller gray">$commify(count)</span>
+                    <span class="small"><a href="$add_facet_url(header, k)" title="$_('Filter results for ebook availability')">$display</a></span>&nbsp;<span class="smaller gray">$commify(count)</span>
                 $else:
-                    <span class="small"><a href="$:add_facet_url(header, k)" title="$_('Filter results for %(facet)s', facet=display)">$display</a></span>&nbsp;<span class="smaller gray">$commify(count)</span>
+                    <span class="small"><a href="$add_facet_url(header, k)" title="$_('Filter results for %(facet)s', facet=display)">$display</a></span>&nbsp;<span class="smaller gray">$commify(count)</span>
                 </div>
             $if len(counts) > start_facet_count:
                 <div class="facetMoreLess">
diff --git a/vendor/infogami b/vendor/infogami
index 9eea4ecee71..b3f8fe65131 160000
--- a/vendor/infogami
+++ b/vendor/infogami
@@ -1 +1 @@
-Subproject commit 9eea4ecee7192f94a3365f12780afb87d0ddf552
+Subproject commit b3f8fe65131903e847a56526a6d7bd4bec3743f9
